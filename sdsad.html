<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Plotly Rubber Band Demo</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <div id="plot"></div>
    <script>
      var data = {
        x: [1, 2, 3, 4, 5],
        y: [1, 3, 2, 4, 3],
        type: "scatter",
        mode: "lines",
        line: {
          width: 3,
          color: "blue",
        },
      };

      var layout = {
        margin: { t: 0 },
        xaxis: { range: [0, 6] },
        yaxis: { range: [0, 5] },
      };

      Plotly.newPlot("plot", [data], layout);

      var rubberBand = false;
      var xOriginal = data.x.slice();
      var yOriginal = data.y.slice();

      var plot = document.getElementById("plot");

      plot.onmousedown = function () {
        rubberBand = true;
      };

      plot.onmousemove = function (event) {
        if (rubberBand) {
          var x = Plotly.d3.event.x;
          var y = Plotly.d3.event.y;
          var xRange = layout.xaxis.range;
          var yRange = layout.yaxis.range;
          var xNew =
            xRange[0] +
            ((x - plot.offsetLeft) / plot.offsetWidth) *
              (xRange[1] - xRange[0]);
          var yNew =
            yRange[0] +
            ((plot.offsetHeight - (y - plot.offsetTop)) / plot.offsetHeight) *
              (yRange[1] - yRange[0]);
          var xData = xOriginal.concat(xNew);
          var yData = yOriginal.concat(yNew);
          Plotly.update("plot", { x: [xData], y: [yData] });
        }
      };

      plot.onmouseup = function () {
        rubberBand = false;
        Plotly.animate(
          "plot",
          {
            data: [{ x: xOriginal, y: yOriginal, line: { color: "blue" } }],
          },
          { transition: { duration: 500 } }
        );
      };
    </script>
  </body>
</html>
